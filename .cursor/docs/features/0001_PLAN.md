# Time Format Utility Library

## Description

Create a comprehensive time-format utility library that combines dayjs and date-fns to provide flexible, internationalized date and time formatting capabilities for the notion-like note-taking app. The utility should support workspace-specific timezone and date format preferences, relative time formatting, and common date operations.

## Technical Requirements

### Core Functionality

- **Dual Library Support**: Leverage both dayjs (lightweight) and date-fns (feature-rich) for different use cases
- **Workspace Integration**: Respect user's timezone and date format preferences from workspace settings
- **Internationalization**: Support multiple locales (Chinese and English) and timezone handling
- **Relative Time**: Smart relative time formatting (e.g., "2 hours ago", "Yesterday", "Last week")
- **Format Consistency**: Standardized date/time formatting across the application

### Files to Create/Modify

#### Primary Implementation

- `apps/client/src/lib/time-format.ts` - Main utility library with comprehensive time formatting functions

#### Integration Points

- `apps/client/src/pages/main/settings/subspace/subspace-table.tsx` - Replace existing `formatDate` function (lines 122-142)
- `apps/client/src/pages/main/settings/workspace/index.tsx` - Integrate with existing timezone/date format settings (lines 22-46, 148-164)

### Algorithm Design

#### 1. Library Selection Strategy

- Use **dayjs** for: lightweight operations, relative time, basic formatting
- Use **date-fns** for: complex date calculations, timezone conversions, advanced formatting

#### 2. Workspace Settings Integration

- Read timezone from `currentWorkspace.settings.timezone` (default: "UTC")
- Read date format from `currentWorkspace.settings.dateFormat` (default: "YYYY/MM/DD")
- Fallback to browser locale if workspace settings unavailable

#### 3. Relative Time Logic

```typescript
// Smart relative time formatting with i18n support
if (diffDays === 0) return t("Today")
if (diffDays === 1) return t("Yesterday")
if (diffDays < 7) return t("{{days}} days ago", { days: diffDays })
if (diffDays < 30) return t("{{weeks}} weeks ago", { weeks: Math.floor(diffDays/7) })
if (diffDays < 365) return t("{{months}} months ago", { months: Math.floor(diffDays/30) })
else return formatted absolute date
```

#### 4. Format Standardization

- Support common formats: YYYY/MM/DD, MM/DD/YYYY, DD/MM/YYYY, YYYY-MM-DD
- Time formats: 12h/24h with timezone display
- Locale-aware formatting using browser/workspace preferences (Chinese/English)

### API Interface Design

#### Core Functions

- `formatDate(date, options?)` - Main date formatting with workspace preferences
- `formatTime(date, options?)` - Time formatting with timezone support
- `formatRelative(date, options?)` - Smart relative time formatting
- `formatDateTime(date, options?)` - Combined date and time formatting
- `parseDate(dateString, format?)` - Parse date strings with format detection
- `getTimezoneOffset(timezone)` - Get timezone offset information
- `isToday(date)`, `isYesterday(date)`, `isThisWeek(date)` - Date comparison helpers

#### Configuration Interface

- `TimeFormatOptions` - Options for formatting behavior
- `WorkspaceTimeSettings` - Integration with workspace settings
- `LocaleConfig` - Internationalization configuration (Chinese/English)
- `I18nTimeConfig` - Translation keys for relative time strings

### Multi-Language Support Requirements

#### Translation Keys Needed

- `time.today` - "Today" / "今天"
- `time.yesterday` - "Yesterday" / "昨天"
- `time.daysAgo` - "{{days}} days ago" / "{{days}}天前"
- `time.weeksAgo` - "{{weeks}} weeks ago" / "{{weeks}}周前"
- `time.monthsAgo` - "{{months}} months ago" / "{{months}}个月前"
- `time.yearsAgo` - "{{years}} years ago" / "{{years}}年前"
- `time.justNow` - "Just now" / "刚刚"
- `time.minutesAgo` - "{{minutes}} minutes ago" / "{{minutes}}分钟前"
- `time.hoursAgo` - "{{hours}} hours ago" / "{{hours}}小时前"

#### Locale-Specific Formatting

- **Chinese (zh-CN)**: Use 24-hour format, prefer YYYY/MM/DD format
- **English (en-US)**: Support both 12h/24h, prefer MM/DD/YYYY format
- **Fallback**: Use browser locale detection with UTC timezone

#### Integration with Existing i18n

- Leverage existing `i18next` setup in the app
- Use `useTranslation` hook for accessing translation functions
- Support dynamic locale switching without page reload

### Dependencies

- **dayjs** (already installed) - Lightweight date library
- **date-fns** (already installed) - Comprehensive date utilities
- **date-fns-tz** - Timezone support for date-fns (needs installation)
- **i18next** (already installed) - Internationalization framework

### Integration Strategy

1. **Phase 1**: Create core utility functions with basic dayjs/date-fns integration
2. **Phase 2**: Add workspace settings integration and timezone support
3. **Phase 3**: Add Chinese/English internationalization support with i18next integration
4. **Phase 4**: Replace existing date formatting in subspace table and other components
5. **Phase 5**: Add comprehensive advanced formatting options and locale-specific date formats

### Error Handling

- Graceful fallback to browser defaults when workspace settings unavailable
- Invalid date handling with user-friendly error messages
- Timezone fallback to UTC when specified timezone invalid
- Format validation with fallback to ISO format

### Performance Considerations

- Lazy loading of timezone data
- Memoization of frequently used format functions
- Minimal bundle size impact through tree-shaking
- Efficient date parsing and validation
